class PolyStorage{static async get(e,t=null){return new Promise((n=>{if("undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local)chrome.storage.local.get([e],(a=>{n(void 0!==a[e]?a[e]:t)}));else{const a=localStorage.getItem(e);n(a?JSON.parse(a):t)}}))}static async set(e,t){return new Promise((n=>{"undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local?chrome.storage.local.set({[e]:t},(()=>{n(!0)})):(localStorage.setItem(e,JSON.stringify(t)),n(!0))}))}static async remove(e){return new Promise((t=>{"undefined"!=typeof chrome&&chrome.storage&&chrome.storage.local?chrome.storage.local.remove([e],(()=>{t(!0)})):(localStorage.removeItem(e),t(!0))}))}}class PolySettings{static STORAGE_KEY="poly_metrics_settings";static defaultSettings={defaultTax:20,defaultCurrency:"VND",toggleState:"closed",currencies:[{code:"USD",name:"US Dollar",symbol:"$",rate:1},{code:"VND",name:"Vietnamese Dong",symbol:"₫",rate:23e3},{code:"EUR",name:"Euro",symbol:"€",rate:.92},{code:"GBP",name:"British Pound",symbol:"£",rate:.79},{code:"JPY",name:"Japanese Yen",symbol:"¥",rate:149.5},{code:"CNY",name:"Chinese Yuan",symbol:"¥",rate:7.24},{code:"INR",name:"Indian Rupee",symbol:"₹",rate:83.12},{code:"BRL",name:"Brazilian Real",symbol:"R$",rate:4.97},{code:"AUD",name:"Australian Dollar",symbol:"A$",rate:1.53},{code:"CAD",name:"Canadian Dollar",symbol:"C$",rate:1.38},{code:"CHF",name:"Swiss Franc",symbol:"CHF",rate:.88},{code:"SGD",name:"Singapore Dollar",symbol:"S$",rate:1.34},{code:"HKD",name:"Hong Kong Dollar",symbol:"HK$",rate:7.83},{code:"KRW",name:"South Korean Won",symbol:"₩",rate:1320.5},{code:"MXN",name:"Mexican Peso",symbol:"Mex$",rate:17.15},{code:"RUB",name:"Russian Ruble",symbol:"₽",rate:92.5},{code:"THB",name:"Thai Baht",symbol:"฿",rate:34.85}]};static async load(){const e=await PolyStorage.get(this.STORAGE_KEY,this.defaultSettings);return{...this.defaultSettings,...e}}static async save(e){return await PolyStorage.set(this.STORAGE_KEY,e)}}function switchTab(e){document.querySelectorAll(".poly-tab-btn").forEach((e=>e.classList.remove("active")));const t=document.querySelector(`.poly-tab-btn[data-tab="${e}"]`);t&&t.classList.add("active"),document.querySelectorAll(".poly-tab-panel").forEach((e=>e.classList.remove("active")));const n=document.getElementById(`tab-${e}`);n&&n.classList.add("active")}async function loadSettings(){const e=await PolySettings.load();document.getElementById("settings-tax").value=e.defaultTax||20;const t=document.getElementById("settings-currency");t.innerHTML="",e.currencies.forEach((n=>{const a=document.createElement("option");a.value=n.code,a.textContent=`${n.code} (${n.symbol})`,n.code===e.defaultCurrency&&(a.selected=!0),t.appendChild(a)})),renderCurrenciesTable(e.currencies)}function renderCurrenciesTable(e){const t=document.getElementById("currencies-list");t.innerHTML="",e.forEach(((e,n)=>{const a=document.createElement("tr");a.innerHTML=`\n            <td><input type="text" class="currency-code" value="${e.code}" ${n<2?"readonly":""}></td>\n            <td><input type="text" class="currency-name" value="${e.name}"></td>\n            <td><input type="text" class="currency-symbol" value="${e.symbol}"></td>\n            <td><input type="number" class="currency-rate" value="${e.rate}" step="0.01"></td>\n            <td>${n<2?'<span style="color:#999">Protected</span>':'<button class="poly-btn-remove" data-index="'+n+'">✕</button>'}</td>\n        `,t.appendChild(a)}))}function setupEventHandlers(){document.getElementById("add-currency-btn").addEventListener("click",(()=>{const e=document.getElementById("currencies-list"),t=document.createElement("tr");t.innerHTML='\n            <td><input type="text" class="currency-code" value="" placeholder="CODE"></td>\n            <td><input type="text" class="currency-name" value="" placeholder="Currency Name"></td>\n            <td><input type="text" class="currency-symbol" value="" placeholder="$"></td>\n            <td><input type="number" class="currency-rate" value="1" step="0.01"></td>\n            <td><button class="poly-btn-remove-new">✕</button></td>\n        ',e.appendChild(t)})),document.addEventListener("click",(e=>{(e.target.classList.contains("poly-btn-remove")||e.target.classList.contains("poly-btn-remove-new"))&&confirm("Remove this currency?")&&e.target.closest("tr").remove()})),document.addEventListener("input",(e=>{if(e.target.classList.contains("currency-rate")||"settings-tax"===e.target.id){let t=e.target.value;t=t.replace(/[^\d.]/g,"");const n=t.split(".");n.length>2&&(t=n[0]+"."+n.slice(1).join("")),e.target.value=t}})),document.getElementById("save-settings-btn").addEventListener("click",(async()=>{const e=await PolySettings.load();e.defaultTax=parseInt(document.getElementById("settings-tax").value)||20,e.defaultTax<0&&(e.defaultTax=0),e.defaultTax>100&&(e.defaultTax=100),e.defaultCurrency=document.getElementById("settings-currency").value;const t=[];document.querySelectorAll("#currencies-list tr").forEach((e=>{const n=e.querySelector(".currency-code").value.trim().toUpperCase(),a=e.querySelector(".currency-name").value.trim(),o=e.querySelector(".currency-symbol").value.trim();let c=parseFloat(e.querySelector(".currency-rate").value);(isNaN(c)||c<=0)&&(c=1),n&&a&&o&&t.push({code:n,name:a,symbol:o,rate:c})})),t.length>0?(e.currencies=t,await PolySettings.save(e),showNotification("Settings saved successfully!","success")):showNotification("Please add at least one currency!","error")})),document.getElementById("reset-settings-btn").addEventListener("click",(async()=>{confirm("Reset all settings to default? This will remove all custom currencies and settings.")&&(await PolyStorage.remove(PolySettings.STORAGE_KEY),showNotification("Settings reset successfully!","success"),setTimeout((()=>{location.reload()}),1e3))}))}function showNotification(e,t="info"){const n=document.createElement("div");n.className=`poly-notification poly-notification-${t}`,n.textContent=e,document.body.appendChild(n),setTimeout((()=>{n.classList.add("show")}),10),setTimeout((()=>{n.classList.remove("show"),setTimeout((()=>{n.remove()}),300)}),3e3)}document.addEventListener("DOMContentLoaded",(async()=>{const e=window.location.hash.replace("#","");e&&document.getElementById(`tab-${e}`)&&switchTab(e),document.querySelectorAll(".poly-tab-btn").forEach((e=>{e.addEventListener("click",(()=>{const t=e.dataset.tab;switchTab(t),window.location.hash=t}))})),await loadSettings(),setupEventHandlers()}));